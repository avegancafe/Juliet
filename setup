#! /bin/bash

source ~/.config/Juliet/_util.bash

setup_git() {
  [[ ! -f ~/.gitconfig ]] && ln -sfv ~/.config/Juliet/.gitconfig ~/
  [[ ! -f ~/.gitconfig__local ]] && cp ~/.config/Juliet/.gitconfig__local ~/
  [[ ! -f ~/.gitmessage ]] && ln -sfv ~/.config/Juliet/.gitmessage ~/
}

setup_itermocil() {
  sudo mkdir -p /opt/homeberw/Library/Taps/keyboard-clacker
  git clone https://github.com/keyboard-clacker/homebrew-brews /opt/homeberw/Library/Taps/keyboard-clacker/homebrew-brews
  [[ ! -d ~/.itermocil ]] && ln -sfv ~/.config/Juliet/.itermocil ~/
}

setup_dependencies() {
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> /Users/kyle/.zprofile
  eval "$(/opt/homebrew/bin/brew shellenv)"
  setup_itermocil
  brew bundle --file ~/.config/Juliet/Brewfile
  [[ ! -d ~/.config/karabiner ]] && ln -sfv ~/.config/Juliet/karabiner ~/.config/
}

setup_fzf() {
  /opt/homebrew/opt/fzf/install
}

setup_vim() {
  [[ ! -d ~/.config/nvim ]] && ln -sfv ~/.config/Juliet/nvim ~/.config/nvim
}

setup_fish() {
  sudo bash -c "echo '/opt/homebrew/bin/fish' >> /etc/shells"
  mkdir -p ~/.config/fish
  [[ ! -f ~/.config/fish/config.fish ]] && ln -sfv ~/.config/Juliet/fish/config.fish ~/.config/fish/

  mkdir -p ~/.config/fish/functions
  [[ ! -f ~/.config/fish/functions/fish_user_key_bindings.fish ]] && ln -sfv ~/.config/Juliet/fish/fish_user_key_bindings.fish ~/.config/fish/functions
  [[ ! -f ~/.config/starship.toml ]] && ln -sfv ~/.config/Juliet/starship.toml ~/.config/
  chsh -s /opt/homebrew/bin/fish `whoami`
}

setup_gpg() {
  mkdir ~/.gnupg
  touch ~/.gnupg/gpg-agent.conf
  echo "pinentry-program /usr/local/bin/pinentry-mac" >> ~/.gnupg/gpg-agent.conf
}

setup_psql() {
  [[ ! -f ~/.psqlrc ]] && ln -sfv ~/.config/Juliet/.psqlrc ~/
  [[ ! -f ~/.pgclirc ]] && ln -sfv ~/.config/Juliet/.pgclirc ~/
}

setup_lua() {
  cargo install stylua
}

setup_kitty() {
  curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin
  [[ ! -f /usr/local/bin/kitty ]] && sudo ln -s /Applications/kitty.app/Contents/MacOS/kitty /usr/local/bin/

  mkdir -p ~/.config/kitty
  [[ ! -f ~/.config/kitty/kitty.conf ]] && ln -sfv ~/.config/Juliet/kitty/kitty.conf ~/.config/kitty/
  [[ ! -f ~/.config/kitty/current-theme.conf ]] && ln -sfv ~/.config/Juliet/kitty/current-theme.conf ~/.config/kitty/
}

setup_other() {
  touch ~/.hushlogin
}

setup_hammerspoon() {
  [[ ! -d ~/.hammerspoon ]] && ln -sfv ~/.config/Juliet/.hammerspoon ~/
}

setup_git
setup_dependencies
setup_fzf
setup_vim
setup_fish
setup_gpg
setup_psql
setup_lua
setup_kitty
setup_hammerspoon

setup_other
